package de.kxmischesdomi.tpef.listener;

import java.util.List;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerCommandPreprocessEvent;

/**
 * @author KxmischesDomi | https://github.com/kxmischesdomi
 * @since 1.0
 */
public class TeleportFixerListener implements Listener {

	private final List<String> teleportCommands;
	private final String blockedTpMessage;
	private final int maxTeleport;

	public TeleportFixerListener(List<String> teleportCommands, String blockedTpMessage, int maxTeleport) {
		this.teleportCommands = teleportCommands;
		this.blockedTpMessage = blockedTpMessage;
		this.maxTeleport = maxTeleport;
	}

	@EventHandler(priority = EventPriority.HIGH)
	public void onTeleportCommand(PlayerCommandPreprocessEvent event) {
		String[] split = event.getMessage().split(" ");
		if (split.length == 0) return;
		if (teleportCommands.contains(split[0].substring(1).toLowerCase())) {
			for (int i = 1; i < split.length; i++) {
				String s = split[i];
				try {
					double aDouble = Double.parseDouble(s);
					if (Math.abs(aDouble) > maxTeleport) {
						event.setCancelled(true);
						event.getPlayer().sendMessage(blockedTpMessage);
						return;
					}
				} catch (Exception exception) { }
			}
		}
	}

}
